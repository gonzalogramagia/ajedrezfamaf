---
import Layout from '../layouts/Layout.astro';

const seoConfig = {
  title: "Gestión de Torneos - Ajedrez FAMAF",
  description: "Panel de gestión de torneos para colegas",
};
---

<Layout title={seoConfig.title} description={seoConfig.description}>
  <div class="min-h-screen bg-gray-50 flex flex-col">
    <!-- Header -->
    <header class="bg-gray-900 border-b border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <a href="/" class="flex items-center space-x-3">
            <img
              src="/ajedrezfamaf.jpg"
              alt="Ajedrez FAMAF"
              class="w-10 h-10 rounded-full"
            />
            <h1 class="text-xl font-bold text-white">Ajedrez FAMAF - Colega</h1>
          </a>
          <a
            href="/torneos"
            class="text-gray-400 hover:text-white transition-colors"
          >
            Torneos
          </a>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <!-- Login Section -->
      <section class="py-16">
        <div class="max-w-md mx-auto px-4 sm:px-6 lg:px-8">
          <div class="bg-white shadow-lg rounded-lg p-8">
            <div class="text-center mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-2">
                Acceso de Colega
              </h2>
              <p class="text-gray-600">
                Ingresa tu contraseña para gestionar torneos
              </p>
            </div>

            <form id="colega-login-form" class="space-y-6">
              <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                  Contraseña de Colega
                </label>
                <input
                  type="password"
                  id="password"
                  name="password"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Ingresa tu contraseña de colega"
                />
              </div>

              <button
                type="submit"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
              >
                Ingresar como Colega
              </button>
            </form>

            <div id="error-message" class="mt-4 text-red-600 text-sm hidden">
              Contraseña incorrecta. Intenta nuevamente.
            </div>
          </div>
        </div>
      </section>

      <!-- Colega Panel (Hidden by default) -->
      <section id="colega-panel" class="hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          
          <!-- Navigation Tabs -->
          <div class="mb-8">
            <nav class="flex space-x-8">
              <button
                id="tab-torneos"
                class="tab-button active py-2 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600"
              >
                Torneos
              </button>
              <button
                id="tab-participantes"
                class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700"
              >
                Participantes
              </button>
              <button
                id="tab-resultados"
                class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700"
              >
                Resultados
              </button>
            </nav>
          </div>

          <!-- Torneos Tab -->
          <div id="content-torneos" class="tab-content">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-gray-900">
                Gestión de Torneos
              </h3>
              <button
                id="create-tournament-btn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
              >
                Crear Nuevo Torneo
              </button>
            </div>

            <!-- Tournaments List -->
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
              <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  <!-- Tournament Card 1 -->
                  <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-4">
                      <span class="px-3 py-1 rounded-full text-xs font-medium text-white bg-blue-500">
                        Próximo
                      </span>
                      <div class="flex space-x-2">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                          Editar
                        </button>
                        <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm admin-only-delete" style="display: none;">
                          Eliminar
                        </button>
                        <button class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm">
                          Cancelar
                        </button>
                      </div>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">
                      Torneo de Apertura 2024
                    </h4>
                    <div class="space-y-2 text-sm text-gray-600">
                      <p>📅 15 de febrero, 2024 - 18:00</p>
                      <p>👥 24/32 jugadores</p>
                      <p>📍 FAMAF - Aula Magna</p>
                      <p>💰 $5.000</p>
                    </div>
                  </div>

                  <!-- Tournament Card 2 -->
                  <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-4">
                      <span class="px-3 py-1 rounded-full text-xs font-medium text-white bg-green-500">
                        Activo
                      </span>
                      <div class="flex space-x-2">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                          Gestionar
                        </button>
                        <button class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                          Ver
                        </button>
                      </div>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">
                      Campeonato de Primavera
                    </h4>
                    <div class="space-y-2 text-sm text-gray-600">
                      <p>📅 20 de abril, 2024 - 17:00</p>
                      <p>👥 20/20 jugadores</p>
                      <p>📍 FAMAF - Biblioteca Central</p>
                      <p>💰 $7.000</p>
                    </div>
                  </div>

                  <!-- Tournament Card 3 -->
                  <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-4">
                      <span class="px-3 py-1 rounded-full text-xs font-medium text-white bg-gray-500">
                        Finalizado
                      </span>
                      <div class="flex space-x-2">
                        <button class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                          Ver
                        </button>
                        <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                          Resultados
                        </button>
                      </div>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">
                      Torneo Septiembre 2022
                    </h4>
                    <div class="space-y-2 text-sm text-gray-600">
                      <p>📅 22 de septiembre, 2022</p>
                      <p>👥 16 participantes</p>
                      <p>📍 FAMAF - Aula Magna</p>
                      <p>🏆 Finalizado</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Participantes Tab -->
          <div id="content-participantes" class="tab-content hidden">
            <div class="mb-6">
              <h3 class="text-2xl font-bold text-gray-900">
                Gestión de Participantes
              </h3>
            </div>

            <!-- Participants List -->
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
              <div class="px-4 py-5 sm:p-6">
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Nombre
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Email
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Teléfono
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Nivel
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Torneo
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Acciones
                        </th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <!-- Mock Participant 1 -->
                      <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                          Juan Pérez
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          juan.perez@example.com
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          +54 9 351 123 4567
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            Intermedio
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          Torneo Apertura 2024
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button class="text-blue-600 hover:text-blue-900 mr-3">Editar</button>
                          <button class="text-red-600 hover:text-red-900 admin-only-delete" style="display: none;">Eliminar</button>
                        </td>
                      </tr>

                      <!-- Mock Participant 2 -->
                      <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                          María González
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          maria.gonzalez@example.com
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          +54 9 351 987 6543
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                            Principiante
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          Torneo Apertura 2024
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button class="text-blue-600 hover:text-blue-900 mr-3">Editar</button>
                          <button class="text-red-600 hover:text-red-900 admin-only-delete" style="display: none;">Eliminar</button>
                        </td>
                      </tr>

                      <!-- Mock Participant 3 -->
                      <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                          Carlos Rodríguez
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          carlos.rodriguez@example.com
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          +54 9 351 555 1234
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                            Avanzado
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          Campeonato Primavera
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button class="text-blue-600 hover:text-blue-900 mr-3">Editar</button>
                          <button class="text-red-600 hover:text-red-900 admin-only-delete" style="display: none;">Eliminar</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Resultados Tab -->
          <div id="content-resultados" class="tab-content hidden">
            <div class="mb-6">
              <h3 class="text-2xl font-bold text-gray-900">
                Resultados de Torneos
              </h3>
            </div>

            <!-- Results List -->
            <div class="bg-white shadow overflow-hidden sm:rounded-md">
              <div class="px-4 py-5 sm:p-6">
                <div class="space-y-6">
                  <!-- Tournament Results 1 -->
                  <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                      <h4 class="text-xl font-semibold text-gray-900">
                        Torneo Septiembre 2022
                      </h4>
                      <span class="px-3 py-1 rounded-full text-xs font-medium text-white bg-gray-500">
                        Finalizado
                      </span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <div class="text-2xl mb-2">🥇</div>
                        <h5 class="font-semibold text-gray-900">1º Lugar</h5>
                        <p class="text-gray-600">Juan Pérez</p>
                        <p class="text-sm text-gray-500">5 puntos</p>
                      </div>
                      
                      <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl mb-2">🥈</div>
                        <h5 class="font-semibold text-gray-900">2º Lugar</h5>
                        <p class="text-gray-600">María González</p>
                        <p class="text-sm text-gray-500">4 puntos</p>
                      </div>
                      
                      <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="text-2xl mb-2">🥉</div>
                        <h5 class="font-semibold text-gray-900">3º Lugar</h5>
                        <p class="text-gray-600">Carlos Rodríguez</p>
                        <p class="text-sm text-gray-500">3 puntos</p>
                      </div>
                    </div>
                  </div>

                  <!-- Tournament Results 2 -->
                  <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                      <h4 class="text-xl font-semibold text-gray-900">
                        Torneo Agosto 2022
                      </h4>
                      <span class="px-3 py-1 rounded-full text-xs font-medium text-white bg-gray-500">
                        Finalizado
                      </span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <div class="text-2xl mb-2">🥇</div>
                        <h5 class="font-semibold text-gray-900">1º Lugar</h5>
                        <p class="text-gray-600">Ana Martínez</p>
                        <p class="text-sm text-gray-500">4.5 puntos</p>
                      </div>
                      
                      <div class="text-center p-4 bg-gray-50 rounded-lg">
                        <div class="text-2xl mb-2">🥈</div>
                        <h5 class="font-semibold text-gray-900">2º Lugar</h5>
                        <p class="text-gray-600">Luis Fernández</p>
                        <p class="text-sm text-gray-500">4 puntos</p>
                      </div>
                      
                      <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="text-2xl mb-2">🥉</div>
                        <h5 class="font-semibold text-gray-900">3º Lugar</h5>
                        <p class="text-gray-600">Sofia López</p>
                        <p class="text-sm text-gray-500">3.5 puntos</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 py-8 mt-auto">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center">
          <a
            class="inline-flex items-center text-gray-300 hover:text-white transition-all text-lg"
            href="https://gonza.gr"
            target="_blank"
            rel="noopener noreferrer"
          >
            💻 🧉 Desarrollado por Gonza
          </a>
          <span class="text-gray-300 text-lg">
            Córdoba, Argentina 🇦🇷
          </span>
        </div>
      </div>
    </footer>
  </div>
</Layout>

<script define:vars={{ 
  COLEGA_PASSWORD: process.env.CHESS_COLEGA_PASSWORD || 'colega123'
}}>
  // Colega authentication
  
  document.getElementById('colega-login-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const password = document.getElementById('password').value;
    const errorMessage = document.getElementById('error-message');
    const colegaPanel = document.getElementById('colega-panel');
    
    if (password === COLEGA_PASSWORD) {
      colegaPanel.classList.remove('hidden');
      this.closest('section').classList.add('hidden');
    } else {
      errorMessage.classList.remove('hidden');
      setTimeout(() => {
        errorMessage.classList.add('hidden');
      }, 3000);
    }
  });

  // Tab functionality
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Remove active class from all buttons
      tabButtons.forEach(btn => {
        btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      
      // Add active class to clicked button
      this.classList.add('active', 'border-blue-500', 'text-blue-600');
      this.classList.remove('border-transparent', 'text-gray-500');
      
      // Hide all tab contents
      tabContents.forEach(content => {
        content.classList.add('hidden');
      });
      
      // Show corresponding tab content
      const tabId = this.id.replace('tab-', 'content-');
      document.getElementById(tabId).classList.remove('hidden');
    });
  });

  // Check if user has admin privileges (from URL params or session)
  function checkAdminPrivileges() {
    // Check if admin password is in URL params (for testing)
    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === 'true';
    
    if (isAdmin) {
      // Show admin-only buttons
      const adminButtons = document.querySelectorAll('.admin-only-delete');
      adminButtons.forEach(btn => {
        btn.style.display = 'inline-block';
      });
    }
    
    return isAdmin;
  }

  // Initialize admin privileges check
  checkAdminPrivileges();

  // Create tournament functionality
  document.getElementById('create-tournament-btn').addEventListener('click', function() {
    alert('Funcionalidad de crear torneo - pendiente de implementar con base de datos');
  });

  // Handle delete buttons (only for admin)
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('admin-only-delete')) {
      const isAdmin = checkAdminPrivileges();
      
      if (!isAdmin) {
        alert('Solo los administradores pueden eliminar torneos y participantes.');
        e.preventDefault();
        return;
      }
      
      // If admin, show confirmation
      if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
        alert('Funcionalidad de eliminación - pendiente de implementar con base de datos');
      }
    }
  });
</script>

<style>
  .tab-button.active {
    @apply border-blue-500 text-blue-600;
  }
</style>
