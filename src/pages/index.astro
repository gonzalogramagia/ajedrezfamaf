---
import Layout from '../layouts/Layout.astro';
import StaticHero from '../components/StaticHero.astro';
import InstagramFloatingButton from '../components/InstagramFloatingButton.astro';
import GithubFloatingButton from '../components/GithubFloatingButton.astro';
import Badge from '../components/Badge.astro';
import Authors from '../components/Authors.astro';
import { getAllPosts } from '../lib/posts';
import { parseMarkdown } from '../lib/markdown';
import { getImageUrl } from '../lib/storage';

const seoConfig = {
  title: "Ajedrez FAMAF",
  description: "⚡♟ Web oficial del taller de Ajedrez de FAMAF",
  og: {
    title: "Ajedrez FAMAF",
    description: "Un espacio para compartir novedades, noticias y eventos de la comunidad de ajedrez universitaria.",
    url: "https://ajedrezfamaf.com",
  },
};

// Función para convertir fecha YYYY-MM-DD a formato español
function formatDateToSpanish(dateString: string): string {
  const date = new Date(dateString);
  const months = [
    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
  ];
  
  const day = date.getDate();
  const month = months[date.getMonth()];
  
  return `${day} de ${month}`;
}

// Obtener todos los posts desde Supabase (ya ordenados por el campo 'order')
const posts = await getAllPosts();
---

<Layout title={seoConfig.title} description={seoConfig.description}>
  <main class="min-h-screen relative">
    <StaticHero />
    <InstagramFloatingButton />
    <GithubFloatingButton />
    <div class="lg:pr-56">
      <section
        class="relative mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 overflow-hidden"
      >
        {posts.map((post) => (
          <article class="md:flex">
                  <h2 class="content-date h-full mt-px">
                    <a href="#2022-06-23">{formatDateToSpanish(post.date)}</a>
                  </h2>
            <div class="content-block">
              <div class="feed-border"></div>
              <div class="feed-dot"></div>
              <div class="mb-6">
                <Badge label={post.version} />
              </div>
              <h1 class="text-xl sm:text-3xl font-bold mb-4">
                <a 
                  href={`/${post.slug || '#'}`}
                  class="hover:text-primary transition-colors"
                >
                  {post.title}
                </a>
              </h1>
              <div class="document" set:html={parseMarkdown(post.content, `/${post.slug || '#'}`)} />
              {post.featured_image && (
                <div class="mt-6">
                  <a href={`/${post.slug || '#'}`}>
                    <img 
                      src={getImageUrl(post.featured_image)} 
                      alt={post.title}
                      class="w-full h-96 md:h-[32rem] object-cover rounded-lg hover:opacity-90 transition-opacity"
                    />
                  </a>
                </div>
              )}
            </div>
          </article>
        ))}
      </section>
    </div>
    
    <!-- Footer con Gonza -->
    <section class="relative mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 pt-8 pb-10 md:py-8">
      <div class="text-left md:text-center pl-6 md:pl-0">
        <p class="inline-flex items-center text-yellow-500 text-lg font-semibold">
          © 2026 | Mens sana in corpore sano
        </p>
      </div>
    </section>
  </main>
</Layout>